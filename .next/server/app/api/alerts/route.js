"use strict";(()=>{var e={};e.id=16,e.ids=[16],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},7567:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>w,serverHooks:()=>S,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>y,dynamic:()=>g});var a=r(9303),i=r(8716),s=r(670),o=r(7070),c=r(2146);let l={minDailyRevenue:100,maxResponseTime:5e3};async function u(){let e=[];try{let t=await (0,c.Wr)();t.products.outOfStock>0&&e.push({id:`stock-out-${Date.now()}`,severity:"critical",category:"stock",title:`ðŸš¨ ${t.products.outOfStock} produit(s) en rupture de stock`,message:`Certains produits ne peuvent plus \xeatre vendus !`,details:t.products.outOfStockItems.map(e=>e.title).join(", "),createdAt:new Date().toISOString(),acknowledged:!1}),t.products.lowStock>0&&e.push({id:`stock-low-${Date.now()}`,severity:"warning",category:"stock",title:`âš ï¸ ${t.products.lowStock} produit(s) en stock faible`,message:`Pr\xe9voir un r\xe9approvisionnement rapidement`,details:t.products.lowStockItems.map(e=>`${e.title}: ${e.inventory} unit\xe9s`).join(", "),createdAt:new Date().toISOString(),acknowledged:!1})}catch(e){console.error("Erreur v\xe9rification stocks:",e)}return e}async function d(){let e=[];try{let t=await (0,c.Wr)();if(0===t.orders.today){let t=new Date().getHours();t>=14&&e.push({id:`orders-none-${Date.now()}`,severity:"warning",category:"orders",title:`ðŸ“‰ Aucune commande aujourd'hui`,message:`Il est ${t}h et aucune commande n'a \xe9t\xe9 pass\xe9e`,createdAt:new Date().toISOString(),acknowledged:!1})}let r=parseFloat(t.revenue.today);r<l.minDailyRevenue&&new Date().getHours()>=18&&e.push({id:`revenue-low-${Date.now()}`,severity:"warning",category:"orders",title:`ðŸ’° CA journalier faible: ${r.toFixed(2)}â‚¬`,message:`Objectif minimum: ${l.minDailyRevenue}â‚¬`,createdAt:new Date().toISOString(),acknowledged:!1})}catch(e){console.error("Erreur v\xe9rification commandes:",e)}return e}async function m(){let e=[];try{let t=Date.now(),r=await fetch("https://weedn.fr",{method:"HEAD",signal:AbortSignal.timeout(1e4)}),n=Date.now()-t;r.ok||e.push({id:`website-down-${Date.now()}`,severity:"critical",category:"website",title:`ðŸ”´ Site weedn.fr inaccessible !`,message:`Code HTTP: ${r.status}`,createdAt:new Date().toISOString(),acknowledged:!1}),n>l.maxResponseTime&&e.push({id:`website-slow-${Date.now()}`,severity:"warning",category:"website",title:`ðŸ¢ Site weedn.fr lent`,message:`Temps de r\xe9ponse: ${n}ms (seuil: ${l.maxResponseTime}ms)`,createdAt:new Date().toISOString(),acknowledged:!1})}catch(t){e.push({id:`website-error-${Date.now()}`,severity:"critical",category:"website",title:`ðŸ”´ Erreur connexion weedn.fr`,message:t.message||"Impossible de joindre le site",createdAt:new Date().toISOString(),acknowledged:!1})}return e}async function p(){let[e,t,r]=await Promise.all([u(),d(),m()]);return[...e,...t,...r].sort((e,t)=>{let r={critical:0,warning:1,info:2},n=r[e.severity]-r[t.severity];return 0!==n?n:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()})}let g="force-dynamic";async function y(){try{let e=await p(),t=e.filter(e=>"critical"===e.severity).length,r=e.filter(e=>"warning"===e.severity).length;return o.NextResponse.json({success:!0,alerts:e,summary:{total:e.length,critical:t,warning:r,info:e.length-t-r},checkedAt:new Date().toISOString()})}catch(e){return console.error("Erreur v\xe9rification alertes:",e),o.NextResponse.json({error:"Erreur v\xe9rification alertes",details:String(e)},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/alerts/route",pathname:"/api/alerts",filename:"route",bundlePath:"app/api/alerts/route"},resolvedPagePath:"/Users/alektkt/Documents/weedn-project/weedn-command-center/src/app/api/alerts/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:S}=w,_="/api/alerts/route";function v(){return(0,s.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:h})}},3212:(e,t,r)=>{r.d(t,{Vi:()=>g,I7:()=>p,oy:()=>m,oD:()=>d});let n=require("fs");var a=r.n(n),i=r(1017),s=r.n(i);let o=process.env.WEEDN_DATA_PATH||"/Users/alektkt/Documents/weedn-project/data",c=null,l=null;function u(){if(c)return c;try{let e=s().join(o,"credentials.json"),t=a().readFileSync(e,"utf-8");return c=JSON.parse(t)}catch(e){return console.error("Erreur chargement credentials:",e),null}}function d(){if(l)return l;try{let e=s().join(o,"contacts.json"),t=a().readFileSync(e,"utf-8");return l=JSON.parse(t)}catch(e){return console.error("Erreur chargement contacts:",e),null}}function m(){let e=u();return e?.shopify?{store:e.shopify.store,storeName:e.shopify.storeName,accessToken:e.shopify.accessToken,adminUrl:e.shopify.adminUrl,apiVersion:"2024-01"}:null}function p(){let e=u();return e?.incwo?{baseUrl:e.incwo.baseUrl,accountId:e.incwo.accountId,email:e.incwo.email,address:e.incwo.address,phone:e.incwo.phone}:null}let g={ANTHROPIC_API_KEY:process.env.WEEDN_CLAUDE_API_KEY||u()?.anthropic?.apiKey,SHOPIFY_ACCESS_TOKEN:process.env.SHOPIFY_ACCESS_TOKEN||u()?.shopify?.accessToken,SHOPIFY_STORE:u()?.shopify?.store||"f24081-64.myshopify.com",SUPABASE_URL:"https://cmgpflxqunkrrbndtnne.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtZ3BmbHhxdW5rcnJibmR0bm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3OTg3OTMsImV4cCI6MjA4NDM3NDc5M30.tgF84dpOJv3h9zyDpxMr72wbqM46a_MbBu3uqQDPwVY",MAKE_API_TOKEN:process.env.MAKE_API_TOKEN||u()?.make?.apiToken,MAKE_ORG_ID:u()?.make?.organizationId,IS_PRODUCTION:!0,DATA_PATH:o}},2146:(e,t,r)=>{r.d(t,{Wr:()=>l});var n=r(3212);async function a(e,t){let r=(0,n.oy)()||{store:process.env.SHOPIFY_STORE||"f24081-64.myshopify.com",accessToken:process.env.SHOPIFY_ACCESS_TOKEN};if(!r.accessToken)throw Error("Shopify non configur\xe9: token manquant");let a=await fetch(`https://${r.store}/admin/api/2024-01${e}`,{...t,headers:{"X-Shopify-Access-Token":r.accessToken,"Content-Type":"application/json",...t?.headers}});if(!a.ok){let e=await a.text();throw Error(`Shopify API Error: ${a.status} - ${e}`)}return a.json()}async function i(e){let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.status&&t.set("status",e.status),e?.created_at_min&&t.set("created_at_min",e.created_at_min),e?.created_at_max&&t.set("created_at_max",e.created_at_max),e?.financial_status&&t.set("financial_status",e.financial_status),e?.fulfillment_status&&t.set("fulfillment_status",e.fulfillment_status);let r=t.toString()?`?${t.toString()}`:"";return a(`/orders.json${r}`)}async function s(e){let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.status&&t.set("status",e.status),e?.product_type&&t.set("product_type",e.product_type),e?.vendor&&t.set("vendor",e.vendor),e?.collection_id&&t.set("collection_id",e.collection_id);let r=t.toString()?`?${t.toString()}`:"";return a(`/products.json${r}`)}async function o(e){let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.created_at_min&&t.set("created_at_min",e.created_at_min),e?.updated_at_min&&t.set("updated_at_min",e.updated_at_min);let r=t.toString()?`?${t.toString()}`:"";return a(`/customers.json${r}`)}async function c(){return a("/shop.json")}async function l(){let[e,t,r,n]=await Promise.all([i({limit:250,status:"any"}),s({limit:250}),o({limit:250}),c()]),a=e.orders||[],l=t.products||[],u=r.customers||[],d=n.shop||{},m=new Date,p=m.toISOString().split("T")[0],g=new Date(m.getTime()-864e5).toISOString().split("T")[0],y=new Date(m.getTime()-6048e5).toISOString(),w=new Date(m.getTime()-2592e6).toISOString(),f=a.filter(e=>e.created_at?.startsWith(p)),h=a.filter(e=>e.created_at?.startsWith(g)),S=a.filter(e=>new Date(e.created_at)>=new Date(y)),_=a.filter(e=>new Date(e.created_at)>=new Date(w)),v=e=>e.reduce((e,t)=>e+parseFloat(t.total_price||0),0),D=v(f),I=v(h),O=v(S),k=v(_),A=v(a),x=a.length>0?A/a.length:0,E=l.map(e=>({id:e.id,title:e.title,handle:e.handle,status:e.status,productType:e.product_type,vendor:e.vendor,inventory:e.variants?.reduce((e,t)=>e+(t.inventory_quantity||0),0)||0,variants:e.variants?.length||0,priceRange:{min:Math.min(...e.variants?.map(e=>parseFloat(e.price)||0)||[0]),max:Math.max(...e.variants?.map(e=>parseFloat(e.price)||0)||[0])},images:e.images?.length||0,createdAt:e.created_at,updatedAt:e.updated_at})),T=E.filter(e=>e.inventory<=5&&e.inventory>0),P=E.filter(e=>0===e.inventory),b=E.filter(e=>"active"===e.status),j=u.filter(e=>new Date(e.created_at)>=new Date(w)).length,$={};a.forEach(e=>{e.line_items?.forEach(e=>{let t=e.product_id?.toString()||e.title;$[t]||($[t]={title:e.title,quantity:0,revenue:0}),$[t].quantity+=e.quantity,$[t].revenue+=parseFloat(e.price)*e.quantity})});let F=Object.values($).sort((e,t)=>t.revenue-e.revenue).slice(0,10);return{shop:{name:d.name,email:d.email,domain:d.domain,currency:d.currency,timezone:d.timezone,country:d.country_name},revenue:{today:D.toFixed(2),yesterday:I.toFixed(2),last7Days:O.toFixed(2),last30Days:k.toFixed(2),total:A.toFixed(2),avgOrderValue:x.toFixed(2)},orders:{today:f.length,yesterday:h.length,last7Days:S.length,last30Days:_.length,total:a.length,recent:a.slice(0,10).map(e=>({id:e.id,number:e.order_number,total:e.total_price,currency:e.currency,financialStatus:e.financial_status,fulfillmentStatus:e.fulfillment_status,customerEmail:e.email,itemCount:e.line_items?.length||0,createdAt:e.created_at}))},products:{total:l.length,active:b.length,lowStock:T.length,outOfStock:P.length,lowStockItems:T,outOfStockItems:P,all:E},customers:{total:u.length,newLast30Days:j},topProducts:F,generatedAt:new Date().toISOString()}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(7567));module.exports=n})();