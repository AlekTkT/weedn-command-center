"use strict";(()=>{var e={};e.id=827,e.ids=[827],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},6827:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>S,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>_,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var a={};n.r(a),n.d(a,{GET:()=>h});var r=n(9303),i=n(8716),s=n(670),o=n(7070),c=n(2146);let l=[{id:"WdUHAd",name:"Newsletter"},{id:"XxdVEX",name:"Engaged in the last 120 days"},{id:"Xnbnxd",name:"Engaged in the last 30 days"},{id:"YKLb8e",name:"Winback â€“ 120 Day Lapsed Purchasers"},{id:"XJNgUg",name:"New subscribers"},{id:"WVP7Xn",name:"Repeat customers"},{id:"VZAcmH",name:"Potential churn"},{id:"WtTmgu",name:"Someone who has recently placed an order"},{id:"WVQFm3",name:"Abandoned cart reminder"}],u=[{id:"WTXhLX",name:"Newsletter"},{id:"WsnmM6",name:"Sample Data List"},{id:"VNKBLH",name:"TEST Liste 01"}];function d(){return{segments:l,lists:u,campaigns:[],account:{email:"cbdoshop75@gmail.com",timezone:"Europe/Paris",currency:"EUR"}}}var m=n(3212);function p(){let e=(0,m.I7)();return{baseUrl:e?.baseUrl||"https://www.incwo.com/1047111",accountId:e?.accountId||"1047111",email:e?.email||"cbdoshop75@gmail.com",address:e?.address||"4 Rue Tiquetonne, 75002 Paris",phone:e?.phone||"01 42 60 98 74"}}async function h(){try{let e=await (0,c.Wr)(),t=d(),n=p(),a=(0,m.oD)();return o.NextResponse.json({success:!0,data:{shopify:e,klaviyo:t,incwo:{config:n,note:"Donn\xe9es boutique physique - int\xe9gration \xe0 compl\xe9ter"},team:a?.team||{},business:a?.business?.weedn||{}},context:{klaviyo:function(){let e=d();return`## DONN\xc9ES KLAVIYO (Email Marketing)

### Segments disponibles (${e.segments.length}):
${e.segments.map(e=>`- ${e.name} (ID: ${e.id})`).join("\n")}

### Listes disponibles (${e.lists.length}):
${e.lists.map(e=>`- ${e.name} (ID: ${e.id})`).join("\n")}

### Actions possibles via MCP:
- Cr\xe9er une campagne email
- Cr\xe9er un template
- Cr\xe9er un flow automatis\xe9
- R\xe9cup\xe9rer les profils
- Analyser les performances`}(),incwo:function(){let e=p();return`## DONN\xc9ES INCWO (Boutique Physique)

### Configuration:
- Adresse: ${e.address}
- T\xe9l\xe9phone: ${e.phone}
- Compte: ${e.accountId}
- Dashboard: ${e.baseUrl}

### Note:
Les donn\xe9es Incwo repr\xe9sentent les ventes EN MAGASIN.
CA Total Weedn = CA Shopify (web) + CA Incwo (boutique)

### \xc0 int\xe9grer:
- Ventes journali\xe8res boutique
- Stock synchronis\xe9
- Comparaison web vs boutique`}()},generatedAt:new Date().toISOString()})}catch(e){return console.error("Full data fetch error:",e),o.NextResponse.json({error:"Erreur r\xe9cup\xe9ration donn\xe9es",details:String(e)},{status:500})}}let _=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/data/route",pathname:"/api/data",filename:"route",bundlePath:"app/api/data/route"},resolvedPagePath:"/Users/alektkt/Documents/weedn-project/weedn-command-center/src/app/api/data/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:f}=_,S="/api/data/route";function w(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},3212:(e,t,n)=>{n.d(t,{Vi:()=>h,I7:()=>p,oy:()=>m,oD:()=>d});let a=require("fs");var r=n.n(a),i=n(1017),s=n.n(i);let o=process.env.WEEDN_DATA_PATH||"/Users/alektkt/Documents/weedn-project/data",c=null,l=null;function u(){if(c)return c;try{let e=s().join(o,"credentials.json"),t=r().readFileSync(e,"utf-8");return c=JSON.parse(t)}catch(e){return console.error("Erreur chargement credentials:",e),null}}function d(){if(l)return l;try{let e=s().join(o,"contacts.json"),t=r().readFileSync(e,"utf-8");return l=JSON.parse(t)}catch(e){return console.error("Erreur chargement contacts:",e),null}}function m(){let e=u();return e?.shopify?{store:e.shopify.store,storeName:e.shopify.storeName,accessToken:e.shopify.accessToken,adminUrl:e.shopify.adminUrl,apiVersion:"2024-01"}:null}function p(){let e=u();return e?.incwo?{baseUrl:e.incwo.baseUrl,accountId:e.incwo.accountId,email:e.incwo.email,address:e.incwo.address,phone:e.incwo.phone}:null}let h={ANTHROPIC_API_KEY:process.env.WEEDN_CLAUDE_API_KEY||u()?.anthropic?.apiKey,SHOPIFY_ACCESS_TOKEN:process.env.SHOPIFY_ACCESS_TOKEN||u()?.shopify?.accessToken,SHOPIFY_STORE:u()?.shopify?.store||"f24081-64.myshopify.com",SUPABASE_URL:"https://cmgpflxqunkrrbndtnne.supabase.co",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNtZ3BmbHhxdW5rcnJibmR0bm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3OTg3OTMsImV4cCI6MjA4NDM3NDc5M30.tgF84dpOJv3h9zyDpxMr72wbqM46a_MbBu3uqQDPwVY",MAKE_API_TOKEN:process.env.MAKE_API_TOKEN||u()?.make?.apiToken,MAKE_ORG_ID:u()?.make?.organizationId,IS_PRODUCTION:!0,DATA_PATH:o}},2146:(e,t,n)=>{n.d(t,{Wr:()=>l});var a=n(3212);async function r(e,t){let n=(0,a.oy)()||{store:process.env.SHOPIFY_STORE||"f24081-64.myshopify.com",accessToken:process.env.SHOPIFY_ACCESS_TOKEN};if(!n.accessToken)throw Error("Shopify non configur\xe9: token manquant");let r=await fetch(`https://${n.store}/admin/api/2024-01${e}`,{...t,headers:{"X-Shopify-Access-Token":n.accessToken,"Content-Type":"application/json",...t?.headers}});if(!r.ok){let e=await r.text();throw Error(`Shopify API Error: ${r.status} - ${e}`)}return r.json()}async function i(e){let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.status&&t.set("status",e.status),e?.created_at_min&&t.set("created_at_min",e.created_at_min),e?.created_at_max&&t.set("created_at_max",e.created_at_max),e?.financial_status&&t.set("financial_status",e.financial_status),e?.fulfillment_status&&t.set("fulfillment_status",e.fulfillment_status);let n=t.toString()?`?${t.toString()}`:"";return r(`/orders.json${n}`)}async function s(e){let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.status&&t.set("status",e.status),e?.product_type&&t.set("product_type",e.product_type),e?.vendor&&t.set("vendor",e.vendor),e?.collection_id&&t.set("collection_id",e.collection_id);let n=t.toString()?`?${t.toString()}`:"";return r(`/products.json${n}`)}async function o(e){let t=new URLSearchParams;e?.limit&&t.set("limit",e.limit.toString()),e?.created_at_min&&t.set("created_at_min",e.created_at_min),e?.updated_at_min&&t.set("updated_at_min",e.updated_at_min);let n=t.toString()?`?${t.toString()}`:"";return r(`/customers.json${n}`)}async function c(){return r("/shop.json")}async function l(){let[e,t,n,a]=await Promise.all([i({limit:250,status:"any"}),s({limit:250}),o({limit:250}),c()]),r=e.orders||[],l=t.products||[],u=n.customers||[],d=a.shop||{},m=new Date,p=m.toISOString().split("T")[0],h=new Date(m.getTime()-864e5).toISOString().split("T")[0],_=new Date(m.getTime()-6048e5).toISOString(),y=new Date(m.getTime()-2592e6).toISOString(),g=r.filter(e=>e.created_at?.startsWith(p)),f=r.filter(e=>e.created_at?.startsWith(h)),S=r.filter(e=>new Date(e.created_at)>=new Date(_)),w=r.filter(e=>new Date(e.created_at)>=new Date(y)),I=e=>e.reduce((e,t)=>e+parseFloat(t.total_price||0),0),v=I(g),x=I(f),E=I(S),A=I(w),O=I(r),b=r.length>0?O/r.length:0,D=l.map(e=>({id:e.id,title:e.title,handle:e.handle,status:e.status,productType:e.product_type,vendor:e.vendor,inventory:e.variants?.reduce((e,t)=>e+(t.inventory_quantity||0),0)||0,variants:e.variants?.length||0,priceRange:{min:Math.min(...e.variants?.map(e=>parseFloat(e.price)||0)||[0]),max:Math.max(...e.variants?.map(e=>parseFloat(e.price)||0)||[0])},images:e.images?.length||0,createdAt:e.created_at,updatedAt:e.updated_at})),T=D.filter(e=>e.inventory<=5&&e.inventory>0),N=D.filter(e=>0===e.inventory),P=D.filter(e=>"active"===e.status),k=u.filter(e=>new Date(e.created_at)>=new Date(y)).length,C={};r.forEach(e=>{e.line_items?.forEach(e=>{let t=e.product_id?.toString()||e.title;C[t]||(C[t]={title:e.title,quantity:0,revenue:0}),C[t].quantity+=e.quantity,C[t].revenue+=parseFloat(e.price)*e.quantity})});let j=Object.values(C).sort((e,t)=>t.revenue-e.revenue).slice(0,10);return{shop:{name:d.name,email:d.email,domain:d.domain,currency:d.currency,timezone:d.timezone,country:d.country_name},revenue:{today:v.toFixed(2),yesterday:x.toFixed(2),last7Days:E.toFixed(2),last30Days:A.toFixed(2),total:O.toFixed(2),avgOrderValue:b.toFixed(2)},orders:{today:g.length,yesterday:f.length,last7Days:S.length,last30Days:w.length,total:r.length,recent:r.slice(0,10).map(e=>({id:e.id,number:e.order_number,total:e.total_price,currency:e.currency,financialStatus:e.financial_status,fulfillmentStatus:e.fulfillment_status,customerEmail:e.email,itemCount:e.line_items?.length||0,createdAt:e.created_at}))},products:{total:l.length,active:P.length,lowStock:T.length,outOfStock:N.length,lowStockItems:T,outOfStockItems:N,all:D},customers:{total:u.length,newLast30Days:k},topProducts:j,generatedAt:new Date().toISOString()}}}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[948,972],()=>n(6827));module.exports=a})();